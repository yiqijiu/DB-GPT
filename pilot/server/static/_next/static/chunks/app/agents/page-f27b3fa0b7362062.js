(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[718],{15175:function(e,t,l){Promise.resolve().then(l.bind(l,4191))},4191:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return E}});var r=l(9268),s=l(67830),a=l(54842),n=l(70900),o=l(62414),i=l(94244),c=l(33155),u=l(7354),h=l(35891),d=l(35086),m=l(53047),x=l(86006),p=l(19700),y=l(92391),f=l(70321),j=l(75403),v=l(99398),g=l(49064);let Z=y.z.object({query:y.z.string().min(1)});var b=e=>{let{messages:t,onSubmit:l,initialMessage:y,readOnly:b,paramsList:w,clearIntialMessage:N}=e,k=x.useRef(null),[P,T]=(0,x.useState)(!1),[C,S]=(0,x.useState)(),[O,R]=(0,x.useState)(),E=(0,p.cI)({resolver:(0,s.F)(Z),defaultValues:{}}),A=async e=>{let{query:t}=e;try{T(!0),E.reset(),await l(t,{select_param:null==w?void 0:w[O]})}catch(e){}finally{T(!1)}},W=async()=>{try{let e=new URLSearchParams(window.location.search);e.delete("initMessage"),window.history.replaceState(null,null,"?".concat(e.toString())),await A({query:y})}catch(e){console.log(e)}finally{null==N||N()}},M={overrides:{code:e=>{let{children:t}=e;return(0,r.jsx)(v.Z,{language:"javascript",style:g.Z,children:t})}}};return x.useEffect(()=>{k.current&&k.current.scrollTo(0,k.current.scrollHeight)},[null==t?void 0:t.length]),x.useEffect(()=>{y&&t.length<=0&&W()},[y]),x.useEffect(()=>{var e,t;w&&(null===(e=Object.keys(w||{}))||void 0===e?void 0:e.length)>0&&R(null===(t=Object.keys(w||{}))||void 0===t?void 0:t[0])},[w]),(0,r.jsx)("div",{className:"mx-auto flex h-full max-w-3xl flex-col gap-6 px-5 py-6 sm:gap-8 xl:max-w-5xl",children:(0,r.jsxs)(n.Z,{direction:"column",gap:2,sx:{display:"flex",flex:1,flexBasis:"100%",width:"100%",height:"100%",maxHeight:"100%",minHeight:"100%",mx:"auto"},children:[(0,r.jsxs)(n.Z,{ref:k,direction:"column",gap:2,sx:{boxSizing:"border-box",maxWidth:"100%",width:"100%",mx:"auto",flex:1,maxHeight:"100%",overflowY:"auto",p:2,border:"1px solid",borderColor:"var(--joy-palette-divider)"},children:[C&&(0,r.jsx)(o.Z,{size:"sm",variant:"outlined",color:"primary",className:"message-agent",sx:{mr:"auto",ml:"none",whiteSpace:"pre-wrap"},children:null==C?void 0:C.context}),t.filter(e=>["view","human"].includes(e.role)).map((e,t)=>{var l;return(0,r.jsx)(n.Z,{sx:{mr:"view"===e.role?"auto":"none",ml:"human"===e.role?"auto":"none"},children:(0,r.jsx)(o.Z,{size:"sm",variant:"outlined",className:"view"===e.role?"message-agent":"message-human",color:"view"===e.role?"primary":"neutral",sx:e=>({px:2,"ol, ul":{my:0,pl:2},ol:{listStyle:"numeric"},ul:{listStyle:"disc",mb:2},li:{my:1},a:{textDecoration:"underline"}}),children:(0,r.jsx)(j.Z,{options:M,children:null===(l=e.context)||void 0===l?void 0:l.replaceAll("\\n","\n")})})},t)}),P&&(0,r.jsx)(i.Z,{variant:"soft",color:"neutral",size:"sm",sx:{mx:"auto",my:2}})]}),!b&&(0,r.jsxs)("form",{style:{maxWidth:"100%",width:"100%",position:"relative",display:"flex",marginTop:"auto",overflow:"visible",background:"none",justifyContent:"center",marginLeft:"auto",marginRight:"auto",flexDirection:"column",gap:"12px"},onSubmit:e=>{e.stopPropagation(),E.handleSubmit(A)(e)},children:[Object.keys(w||{}).length>0&&(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(c.Z,{value:O,onChange:(e,t)=>{R(t)},className:"max-w-xs",children:Object.keys(w||{}).map(e=>(0,r.jsx)(u.Z,{value:e,children:null==w?void 0:w[e]},e))}),(0,r.jsx)(h.Z,{className:"cursor-pointer",title:O,placement:"top",variant:"outlined",children:(0,r.jsx)(f.Z,{})})]}),(0,r.jsx)(d.ZP,{sx:{width:"100%"},variant:"outlined",endDecorator:(0,r.jsx)(m.ZP,{type:"submit",disabled:P,children:(0,r.jsx)(a.Z,{})}),...E.register("query")})]})]})})},w=l(91440),N=l(50645),k=l(5737),P=l(45642),T=l(26974),C=l(22046),S=l(78417),O=l(66487);let R=(0,N.Z)(k.Z)(e=>{let{theme:t}=e;return{...t.typography.body2,padding:t.spacing(1),textAlign:"center",borderRadius:4,color:t.vars.palette.text.secondary}});var E=()=>{let{handleChatSubmit:e,history:t}=(0,O.Z)({queryAgentURL:"/v1/chat/completions"}),l=[{year:"1951 年",sales:0},{year:"1952 年",sales:52},{year:"1956 年",sales:61},{year:"1957 年",sales:45},{year:"1958 年",sales:48},{year:"1959 年",sales:38},{year:"1960 年",sales:38},{year:"1962 年",sales:38}];return(0,r.jsx)("div",{className:"p-4 flex flex-row gap-6 min-h-full w-full",children:(0,r.jsx)("div",{className:"flex w-full",children:(0,r.jsxs)(P.Z,{container:!0,spacing:2,sx:{flexGrow:1},children:[(0,r.jsx)(P.Z,{xs:8,children:(0,r.jsxs)(S.Z,{spacing:2,className:"h-full",children:[(0,r.jsx)(R,{children:(0,r.jsx)(P.Z,{container:!0,spacing:2,children:[{label:"Revenue Won",value:"$7,811,851"},{label:"Close %",value:"37.7%"},{label:"AVG Days to Close",value:"121"},{label:"Opportunities Won",value:"526"}].map(e=>(0,r.jsx)(P.Z,{xs:3,children:(0,r.jsx)(o.Z,{className:"flex-1 h-full",children:(0,r.jsxs)(T.Z,{className:"justify-around",children:[(0,r.jsx)(C.ZP,{gutterBottom:!0,component:"div",children:e.label}),(0,r.jsx)(C.ZP,{children:e.value})]})})},e.label))})}),(0,r.jsx)(R,{className:"flex-1",children:(0,r.jsx)(o.Z,{className:"h-full",children:(0,r.jsxs)(T.Z,{className:"h-full",children:[(0,r.jsx)(C.ZP,{gutterBottom:!0,component:"div",children:"Revenue Won by Month"}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)(w.Chart,{padding:[10,20,50,40],autoFit:!0,data:[{month:"Jan",city:"Tokyo",temperature:7},{month:"Feb",city:"Tokyo",temperature:13},{month:"Mar",city:"Tokyo",temperature:16.5},{month:"Apr",city:"Tokyo",temperature:14.5},{month:"May",city:"Tokyo",temperature:10},{month:"Jun",city:"Tokyo",temperature:7.5},{month:"Jul",city:"Tokyo",temperature:9.2},{month:"Aug",city:"Tokyo",temperature:14.5},{month:"Sep",city:"Tokyo",temperature:9.3},{month:"Oct",city:"Tokyo",temperature:8.3},{month:"Nov",city:"Tokyo",temperature:8.9},{month:"Dec",city:"Tokyo",temperature:5.6}],children:(0,r.jsx)(w.LineAdvance,{shape:"smooth",point:!0,area:!0,position:"month*temperature",color:"city"})})})]})})}),(0,r.jsx)(R,{className:"flex-1",children:(0,r.jsxs)(P.Z,{container:!0,spacing:2,className:"h-full",children:[(0,r.jsx)(P.Z,{xs:4,className:"h-full",children:(0,r.jsx)(o.Z,{className:"flex-1 h-full",children:(0,r.jsxs)(T.Z,{className:"h-full",children:[(0,r.jsx)(C.ZP,{gutterBottom:!0,component:"div",children:"Close % by Month"}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)(w.Chart,{autoFit:!0,data:l,children:[(0,r.jsx)(w.Interval,{position:"year*sales",style:{lineWidth:3,stroke:(0,w.getTheme)().colors10[0]}}),(0,r.jsx)(w.Tooltip,{shared:!0})]})})]})})}),(0,r.jsx)(P.Z,{xs:4,className:"h-full",children:(0,r.jsx)(o.Z,{className:"flex-1 h-full",children:(0,r.jsxs)(T.Z,{className:"h-full",children:[(0,r.jsx)(C.ZP,{gutterBottom:!0,component:"div",children:"Close % by Month"}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)(w.Chart,{autoFit:!0,data:l,children:[(0,r.jsx)(w.Interval,{position:"year*sales",style:{lineWidth:3,stroke:(0,w.getTheme)().colors10[0]}}),(0,r.jsx)(w.Tooltip,{shared:!0})]})})]})})}),(0,r.jsx)(P.Z,{xs:4,className:"h-full",children:(0,r.jsx)(o.Z,{className:"flex-1 h-full",children:(0,r.jsxs)(T.Z,{className:"h-full",children:[(0,r.jsx)(C.ZP,{gutterBottom:!0,component:"div",children:"Close % by Month"}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)(w.Chart,{autoFit:!0,data:l,children:[(0,r.jsx)(w.Interval,{position:"year*sales",style:{lineWidth:3,stroke:(0,w.getTheme)().colors10[0]}}),(0,r.jsx)(w.Tooltip,{shared:!0})]})})]})})})]})})]})}),(0,r.jsx)(P.Z,{xs:4,children:(0,r.jsx)(b,{messages:t,onSubmit:e})})]})})})}},57931:function(e,t,l){"use strict";l.d(t,{ZP:function(){return c},Cg:function(){return o}});var r=l(9268),s=l(89081),a=l(78915),n=l(86006);let[o,i]=function(){let e=n.createContext(void 0);return[function(){let t=n.useContext(e);if(void 0===t)throw Error("useCtx must be inside a Provider with a value");return t},e.Provider]}();var c=e=>{let{children:t}=e,{run:l,data:n,refresh:o}=(0,s.Z)(async()=>await (0,a.Tk)("/v1/chat/dialogue/list"),{manual:!0});return(0,r.jsx)(i,{value:{dialogueList:n,queryDialogueList:l,refreshDialogList:o},children:t})}},66487:function(e,t,l){"use strict";l.d(t,{Z:function(){return o}});var r=l(71990),s=l(86006),a=e=>{let t=(0,s.useReducer)((e,t)=>({...e,...t}),{...e});return t},n=l(57931),o=e=>{let{queryAgentURL:t,channel:l,queryBody:o,initHistory:i}=e,[c,u]=a({history:i||[]}),{refreshDialogList:h}=(0,n.Cg)();(0,s.useEffect)(()=>{i&&u({history:i})},[i]);let d=async(e,s)=>{if(!e)return;let a=[...c.history,{role:"human",context:e}],n=a.length;u({history:a});try{let i=new AbortController;await (0,r.L)("".concat("http://127.0.0.1:5000").concat("/api"+t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,...o,user_input:e,channel:l}),signal:i.signal,async onopen(e){if(a.length<=1){h();let e=new URLSearchParams(window.location.search);e.delete("initMessage"),window.history.replaceState(null,null,"?".concat(e.toString()))}(!e.ok||e.headers.get("content-type")!==r.a)&&e.status>=400&&e.status<500&&429!==e.status&&e.status},onclose(){console.log("onclose")},onerror(e){throw Error(e)},onmessage:e=>{var t;if(console.log(e,"e"),e.data=e.data.replaceAll("\\n","\n"),"[DONE]"===e.data)i.abort();else if(null===(t=e.data)||void 0===t?void 0:t.startsWith("[ERROR]"))i.abort(),u({history:[...a,{role:"view",context:e.data.replace("[ERROR]","")}]});else{let t=[...a];e.data&&((null==t?void 0:t[n])?t[n].context="".concat(e.data):t.push({role:"view",context:e.data}),u({history:t}))}}})}catch(e){console.log("---e",e),u({history:[...a,{role:"view",context:"请求出错"}]})}};return{handleChatSubmit:d,history:c.history}}},78915:function(e,t,l){"use strict";l.d(t,{Tk:function(){return c},Kw:function(){return u},PR:function(){return h},Ej:function(){return d}});var r=l(21628),s=l(24214);let a=s.Z.create({baseURL:"http://127.0.0.1:5000"});a.defaults.timeout=1e4,a.interceptors.response.use(e=>e.data,e=>Promise.reject(e));var n=l(84835);let o={"content-type":"application/json"},i=e=>{if(!(0,n.isPlainObject)(e))return JSON.stringify(e);let t={...e};for(let e in t){let l=t[e];"string"==typeof l&&(t[e]=l.trim())}return JSON.stringify(t)},c=(e,t)=>{if(t){let l=Object.keys(t).filter(e=>void 0!==t[e]&&""!==t[e]).map(e=>"".concat(e,"=").concat(t[e])).join("&");l&&(e+="?".concat(l))}return a.get("/api"+e,{headers:o}).then(e=>e).catch(e=>{r.ZP.error(e),Promise.reject(e)})},u=(e,t)=>{let l=i(t);return a.post("/api"+e,{body:l,headers:o}).then(e=>e).catch(e=>{r.ZP.error(e),Promise.reject(e)})},h=(e,t)=>{let l=i(t);return a.post(e,{body:l,headers:o}).then(e=>e).catch(e=>{r.ZP.error(e),Promise.reject(e)})},d=(e,t)=>a.post(e,{body:t}).then(e=>e).catch(e=>{r.ZP.error(e),Promise.reject(e)})}},function(e){e.O(0,[180,757,430,577,214,86,316,259,751,662,481,253,769,744],function(){return e(e.s=15175)}),_N_E=e.O()}]);