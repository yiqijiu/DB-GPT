(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{55749:function(e,t,r){"use strict";var a=r(78997);t.Z=void 0;var n=a(r(76906)),o=r(9268),s=(0,n.default)([(0,o.jsx)("path",{d:"M19.89 10.75c.07.41.11.82.11 1.25 0 4.41-3.59 8-8 8s-8-3.59-8-8c0-.05.01-.1 0-.14 2.6-.98 4.69-2.99 5.74-5.55 3.38 4.14 7.97 3.73 8.99 3.61l-.89-1.93c-.13.01-4.62.38-7.18-3.86 1.01-.16 1.71-.15 2.59-.01 2.52-1.15 1.93-.89 2.76-1.26C14.78 2.3 13.43 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-1.43-.3-2.78-.84-4.01l-1.27 2.76zM8.08 5.03C7.45 6.92 6.13 8.5 4.42 9.47 5.05 7.58 6.37 6 8.08 5.03z"},"0"),(0,o.jsx)("circle",{cx:"15",cy:"13",r:"1.25"},"1"),(0,o.jsx)("circle",{cx:"9",cy:"13",r:"1.25"},"2"),(0,o.jsx)("path",{d:"m23 4.5-2.4-1.1L19.5 1l-1.1 2.4L16 4.5l2.4 1.1L19.5 8l1.1-2.4z"},"3")],"FaceRetouchingNaturalOutlined");t.Z=s},70781:function(e,t,r){"use strict";var a=r(78997);t.Z=void 0;var n=a(r(76906)),o=r(9268),s=(0,n.default)((0,o.jsx)("path",{d:"M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3zm-2 10H6V7h12v12zm-9-6c-.83 0-1.5-.67-1.5-1.5S8.17 10 9 10s1.5.67 1.5 1.5S9.83 13 9 13zm7.5-1.5c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5.67-1.5 1.5-1.5 1.5.67 1.5 1.5zM8 15h8v2H8v-2z"}),"SmartToyOutlined");t.Z=s},90545:function(e,t,r){"use strict";r.d(t,{Z:function(){return p}});var a=r(40431),n=r(46750),o=r(86006),s=r(89791),i=r(4323),l=r(51579),c=r(86601),u=r(95887),d=r(9268);let h=["className","component"];var f=r(47327),v=r(98918);let m=function(e={}){let{themeId:t,defaultTheme:r,defaultClassName:f="MuiBox-root",generateClassName:v}=e,m=(0,i.ZP)("div",{shouldForwardProp:e=>"theme"!==e&&"sx"!==e&&"as"!==e})(l.Z),p=o.forwardRef(function(e,o){let i=(0,u.Z)(r),l=(0,c.Z)(e),{className:p,component:g="div"}=l,x=(0,n.Z)(l,h);return(0,d.jsx)(m,(0,a.Z)({as:g,ref:o,className:(0,s.Z)(p,v?v(f):f),theme:t&&i[t]||i},x))});return p}({defaultTheme:v.Z,defaultClassName:"MuiBox-root",generateClassName:f.Z.generate});var p=m},80966:function(e,t,r){Promise.resolve().then(r.bind(r,59498))},59498:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return k}});var a=r(9268),n=r(89081),o=r(78915),s=r(66487),i=r(67830),l=r(54842),c=r(70900),u=r(62414),d=r(90545),h=r(94244),f=r(33155),v=r(7354),m=r(35086),p=r(53047),g=r(86006),x=r(19700),y=r(92391),j=r(55749),w=r(70781),b=r(75403),Z=r(99398),P=r(49064),S=r(56008);let N=y.z.object({query:y.z.string().min(1)});var R=e=>{var t;let{messages:r,onSubmit:n,readOnly:o,paramsList:s,clearIntialMessage:y}=e,R=(0,S.useSearchParams)(),_=R.get("initMessage"),k=g.useRef(null),[C,O]=(0,g.useState)(!1),[E,z]=(0,g.useState)(),L=(0,x.cI)({resolver:(0,i.F)(N),defaultValues:{}}),A=async e=>{let{query:t}=e;try{console.log("submit"),O(!0),L.reset(),await n(t,{select_param:null==s?void 0:s[E]})}catch(e){}finally{O(!1)}},M=async()=>{try{let e=new URLSearchParams(window.location.search),t=e.get("initMessage");e.delete("initMessage"),window.history.replaceState(null,null,"?".concat(e.toString())),await A({query:t})}catch(e){console.log(e)}finally{null==y||y()}},T={overrides:{code:e=>{let{children:t}=e;return(0,a.jsx)(Z.Z,{language:"javascript",style:P.Z,children:t})}},wrapper:g.Fragment};return g.useEffect(()=>{k.current&&k.current.scrollTo(0,k.current.scrollHeight)},[null==r?void 0:r.length]),g.useEffect(()=>{_&&r.length<=0&&M()},[_,r.length]),g.useEffect(()=>{var e,t;s&&(null===(e=Object.keys(s||{}))||void 0===e?void 0:e.length)>0&&z(null===(t=Object.keys(s||{}))||void 0===t?void 0:t[0])},[s]),(0,a.jsx)("div",{className:"w-full h-full",children:(0,a.jsxs)(c.Z,{className:"w-full h-full bg-[#fefefe] dark:bg-[#212121]",sx:{table:{borderCollapse:"collapse",border:"1px solid #ccc",width:"100%"},"th, td":{border:"1px solid #ccc",padding:"10px",textAlign:"center"}},children:[(0,a.jsxs)(c.Z,{ref:k,direction:"column",sx:{overflowY:"auto",maxHeight:"100%",flex:1},children:[null===(t=r.filter(e=>["view","human"].includes(e.role)))||void 0===t?void 0:t.map((e,t)=>{var r;return(0,a.jsx)(c.Z,{children:(0,a.jsx)(u.Z,{size:"sm",variant:"outlined",color:"view"===e.role?"primary":"neutral",sx:t=>({background:"view"===e.role?"var(--joy-palette-primary-softBg, var(--joy-palette-primary-100, #DDF1FF))":"unset",border:"unset",borderRadius:"unset",padding:"24px 0 26px 0",lineHeight:"24px"}),children:(0,a.jsxs)(d.Z,{sx:{width:"76%",margin:"0 auto"},className:"flex flex-row",children:[(0,a.jsx)("div",{className:"mr-3 inline",children:"view"===e.role?(0,a.jsx)(w.Z,{}):(0,a.jsx)(j.Z,{})}),(0,a.jsx)("div",{className:"inline align-middle mt-0.5 max-w-full flex-1 overflow-auto",children:(0,a.jsx)(b.Z,{options:T,children:null===(r=e.context)||void 0===r?void 0:r.replaceAll("\\n","\n")})})]})})},t)}),C&&(0,a.jsx)(h.Z,{variant:"soft",color:"neutral",size:"sm",sx:{mx:"auto",my:2}})]}),!o&&(0,a.jsx)(d.Z,{className:"bg-[#fefefe] dark:bg-[#212121] before:bg-[#fefefe] before:dark:bg-[#212121]",sx:{position:"relative","&::before":{content:'" "',position:"absolute",top:"-18px",left:"0",right:"0",width:"100%",margin:"0 auto",height:"20px",filter:"blur(10px)",zIndex:2}},children:(0,a.jsxs)("form",{style:{maxWidth:"100%",width:"76%",position:"relative",display:"flex",marginTop:"auto",overflow:"visible",background:"none",justifyContent:"center",marginLeft:"auto",marginRight:"auto",flexDirection:"column",gap:"12px",paddingBottom:"58px",paddingTop:"20px"},onSubmit:e=>{e.stopPropagation(),L.handleSubmit(A)(e)},children:[Object.keys(s||{}).length>0&&(0,a.jsx)("div",{className:"flex items-center gap-3",children:(0,a.jsx)(f.Z,{value:E,onChange:(e,t)=>{z(t)},sx:{maxWidth:"100%"},children:Object.keys(s||{}).map(e=>(0,a.jsx)(v.Z,{value:e,children:e},e))})}),(0,a.jsx)(m.ZP,{className:"w-full h-12",variant:"outlined",endDecorator:(0,a.jsx)(p.ZP,{type:"submit",disabled:C,children:(0,a.jsx)(l.Z,{})}),...L.register("query")})]})})]})})},_=r(57931),k=()=>{let e=(0,S.useSearchParams)(),{refreshDialogList:t}=(0,_.Cg)(),r=e.get("id"),i=e.get("scene"),{data:l}=(0,n.Z)(async()=>await (0,o.Tk)("/v1/chat/dialogue/messages/history",{con_uid:r}),{ready:!!r,refreshDeps:[r]}),{data:c}=(0,n.Z)(async()=>await (0,o.Kw)("/v1/chat/mode/params/list?chat_mode=".concat(i)),{ready:!!i,refreshDeps:[r,i]}),{history:u,handleChatSubmit:d}=(0,s.Z)({queryAgentURL:"/v1/chat/completions",queryBody:{conv_uid:r,chat_mode:i||"chat_normal"},initHistory:null==l?void 0:l.data});return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(R,{clearIntialMessage:async()=>{await t()},messages:u||[],onSubmit:d,paramsList:null==c?void 0:c.data})})}},57931:function(e,t,r){"use strict";r.d(t,{ZP:function(){return c},Cg:function(){return i}});var a=r(9268),n=r(89081),o=r(78915),s=r(86006);let[i,l]=function(){let e=s.createContext(void 0);return[function(){let t=s.useContext(e);if(void 0===t)throw Error("useCtx must be inside a Provider with a value");return t},e.Provider]}();var c=e=>{let{children:t}=e,{run:r,data:s,refresh:i}=(0,n.Z)(async()=>await (0,o.Tk)("/v1/chat/dialogue/list"),{manual:!0});return(0,a.jsx)(l,{value:{dialogueList:s,queryDialogueList:r,refreshDialogList:i},children:t})}},66487:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var a=r(71990),n=r(86006),o=e=>{let t=(0,n.useReducer)((e,t)=>({...e,...t}),{...e});return t},s=r(57931),i=r(52040),l=e=>{let{queryAgentURL:t,channel:r,queryBody:l,initHistory:c}=e,[u,d]=o({history:c||[]}),{refreshDialogList:h}=(0,s.Cg)();(0,n.useEffect)(()=>{c&&d({history:c})},[c]);let f=async(e,n)=>{if(!e)return;let o=[...u.history,{role:"human",context:e}],s=o.length;d({history:o});try{let c=new AbortController;await (0,a.L)("".concat(i.env.API_BASE_URL?i.env.API_BASE_URL:"").concat("/api"+t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...n,...l,user_input:e,channel:r}),signal:c.signal,async onopen(e){if(o.length<=1){h();let e=new URLSearchParams(window.location.search);e.delete("initMessage"),window.history.replaceState(null,null,"?".concat(e.toString()))}(!e.ok||e.headers.get("content-type")!==a.a)&&e.status>=400&&e.status<500&&429!==e.status&&e.status},onclose(){console.log("onclose")},onerror(e){throw Error(e)},onmessage:e=>{var t;if(console.log(e,"e"),e.data=e.data.replaceAll("\\n","\n"),"[DONE]"===e.data)c.abort();else if(null===(t=e.data)||void 0===t?void 0:t.startsWith("[ERROR]"))c.abort(),d({history:[...o,{role:"view",context:e.data.replace("[ERROR]","")}]});else{let t=[...o];e.data&&((null==t?void 0:t[s])?t[s].context="".concat(e.data):t.push({role:"view",context:e.data}),d({history:t}))}}})}catch(e){console.log("---e",e),d({history:[...o,{role:"view",context:"请求出错"}]})}};return{handleChatSubmit:f,history:u.history}}},78915:function(e,t,r){"use strict";r.d(t,{Tk:function(){return u},Kw:function(){return d},PR:function(){return h},Ej:function(){return f}});var a=r(21628),n=r(24214),o=r(52040);let s=n.Z.create({baseURL:o.env.API_BASE_URL});s.defaults.timeout=1e4,s.interceptors.response.use(e=>e.data,e=>Promise.reject(e));var i=r(84835);let l={"content-type":"application/json"},c=e=>{if(!(0,i.isPlainObject)(e))return JSON.stringify(e);let t={...e};for(let e in t){let r=t[e];"string"==typeof r&&(t[e]=r.trim())}return JSON.stringify(t)},u=(e,t)=>{if(t){let r=Object.keys(t).filter(e=>void 0!==t[e]&&""!==t[e]).map(e=>"".concat(e,"=").concat(t[e])).join("&");r&&(e+="?".concat(r))}return s.get("/api"+e,{headers:l}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})},d=(e,t)=>{let r=c(t);return s.post("/api"+e,{body:r,headers:l}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})},h=(e,t)=>{let r=c(t);return s.post(e,{body:r,headers:l}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})},f=(e,t)=>s.post(e,{body:t}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})},56008:function(e,t,r){e.exports=r(30794)}},function(e){e.O(0,[180,106,685,86,316,259,751,662,253,769,744],function(){return e(e.s=80966)}),_N_E=e.O()}]);