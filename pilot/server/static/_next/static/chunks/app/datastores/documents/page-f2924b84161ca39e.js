(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[470],{78141:function(e,t,i){"use strict";var a=i(78997);t.Z=void 0;var r=a(i(76906)),n=i(9268),o=(0,r.default)((0,n.jsx)("path",{d:"m19 8-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3l-4-4zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4H6z"}),"Cached");t.Z=o},78273:function(e,t,i){Promise.resolve().then(i.bind(i,16692))},16692:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return ei}});var a=i(9268),r=i(56008),n=i(86006),o=i(50645),s=i(5737),l=i(78635),c=i(70900),d=i(44334),h=i(311),p=i(22046),u=i(53113),g=i(83192),m=i(46750),x=i(40431),v=i(89791),f=i(47562),C=i(46319),b=i(53832),j=i(49657),Z=i(88930),y=i(47093),P=i(18587);function S(e){return(0,P.d6)("MuiChip",e)}let w=(0,P.sI)("MuiChip",["root","clickable","colorPrimary","colorNeutral","colorDanger","colorInfo","colorSuccess","colorWarning","colorContext","disabled","endDecorator","focusVisible","label","labelSm","labelMd","labelLg","sizeSm","sizeMd","sizeLg","startDecorator","variantPlain","variantSolid","variantSoft","variantOutlined"]),_=n.createContext({disabled:void 0,variant:void 0,color:void 0});var k=i(326);let D=["children","className","color","slotProps","onClick","disabled","size","variant","startDecorator","endDecorator"],z=e=>{let{disabled:t,size:i,color:a,clickable:r,variant:n,focusVisible:o}=e,s={root:["root",t&&"disabled",a&&`color${(0,b.Z)(a)}`,i&&`size${(0,b.Z)(i)}`,n&&`variant${(0,b.Z)(n)}`,r&&"clickable"],action:["action",t&&"disabled",o&&"focusVisible"],label:["label",i&&`label${(0,b.Z)(i)}`],startDecorator:["startDecorator"],endDecorator:["endDecorator"]};return(0,f.Z)(s,S,{})},R=(0,o.Z)("div",{name:"JoyChip",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e,ownerState:t})=>{var i,a,r,n,o,s;return[(0,x.Z)({"--Chip-decoratorChildOffset":"min(calc(var(--Chip-paddingInline) - (var(--_Chip-minHeight) - 2 * var(--variant-borderWidth, 0px) - var(--Chip-decoratorChildHeight)) / 2), var(--Chip-paddingInline))","--Chip-decoratorChildRadius":"max(var(--_Chip-radius) - var(--variant-borderWidth, 0px) - var(--_Chip-paddingBlock), min(var(--_Chip-paddingBlock) + var(--variant-borderWidth, 0px), var(--_Chip-radius) / 2))","--Chip-deleteRadius":"var(--Chip-decoratorChildRadius)","--Chip-deleteSize":"var(--Chip-decoratorChildHeight)","--Avatar-radius":"var(--Chip-decoratorChildRadius)","--Avatar-size":"var(--Chip-decoratorChildHeight)","--Icon-margin":"initial","--unstable_actionRadius":"var(--_Chip-radius)"},"sm"===t.size&&{"--Chip-gap":"0.25rem","--Chip-paddingInline":"0.5rem","--Chip-decoratorChildHeight":"calc(min(1.125rem, var(--_Chip-minHeight)) - 2 * var(--variant-borderWidth, 0px))","--Icon-fontSize":"calc(var(--_Chip-minHeight) / 1.714)","--_Chip-minHeight":"var(--Chip-minHeight, 1.5rem)",fontSize:e.vars.fontSize.xs},"md"===t.size&&{"--Chip-gap":"0.375rem","--Chip-paddingInline":"0.75rem","--Chip-decoratorChildHeight":"min(1.375rem, var(--_Chip-minHeight))","--Icon-fontSize":"calc(var(--_Chip-minHeight) / 1.778)","--_Chip-minHeight":"var(--Chip-minHeight, 2rem)",fontSize:e.vars.fontSize.sm},"lg"===t.size&&{"--Chip-gap":"0.5rem","--Chip-paddingInline":"1rem","--Chip-decoratorChildHeight":"min(1.75rem, var(--_Chip-minHeight))","--Icon-fontSize":"calc(var(--_Chip-minHeight) / 2)","--_Chip-minHeight":"var(--Chip-minHeight, 2.5rem)",fontSize:e.vars.fontSize.md},{"--_Chip-radius":"var(--Chip-radius, 1.5rem)","--_Chip-paddingBlock":"max((var(--_Chip-minHeight) - 2 * var(--variant-borderWidth, 0px) - var(--Chip-decoratorChildHeight)) / 2, 0px)",minHeight:"var(--_Chip-minHeight)",paddingInline:"var(--Chip-paddingInline)",borderRadius:"var(--_Chip-radius)",position:"relative",fontWeight:e.vars.fontWeight.md,fontFamily:e.vars.fontFamily.body,display:"inline-flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",textDecoration:"none",verticalAlign:"middle",boxSizing:"border-box",[`&.${w.disabled}`]:{color:null==(i=e.variants[`${t.variant}Disabled`])?void 0:null==(a=i[t.color])?void 0:a.color}}),...t.clickable?[{"--variant-borderWidth":"0px",color:null==(o=e.variants[t.variant])?void 0:null==(s=o[t.color])?void 0:s.color}]:[null==(r=e.variants[t.variant])?void 0:r[t.color],{[`&.${w.disabled}`]:null==(n=e.variants[`${t.variant}Disabled`])?void 0:n[t.color]}]]}),I=(0,o.Z)("span",{name:"JoyChip",slot:"Label",overridesResolver:(e,t)=>t.label})(({ownerState:e})=>(0,x.Z)({display:"inline-block",overflow:"hidden",textOverflow:"ellipsis",order:1,minInlineSize:0,flexGrow:1},e.clickable&&{zIndex:1,pointerEvents:"none"})),H=(0,o.Z)("button",{name:"JoyChip",slot:"Action",overridesResolver:(e,t)=>t.action})(({theme:e,ownerState:t})=>{var i,a,r,n;return[{position:"absolute",zIndex:0,top:0,left:0,bottom:0,right:0,border:"none",cursor:"pointer",padding:"initial",margin:"initial",backgroundColor:"initial",textDecoration:"none",borderRadius:"inherit",[e.focus.selector]:e.focus.default},null==(i=e.variants[t.variant])?void 0:i[t.color],{"&:hover":null==(a=e.variants[`${t.variant}Hover`])?void 0:a[t.color]},{"&:active":null==(r=e.variants[`${t.variant}Active`])?void 0:r[t.color]},{[`&.${w.disabled}`]:null==(n=e.variants[`${t.variant}Disabled`])?void 0:n[t.color]}]}),N=(0,o.Z)("span",{name:"JoyChip",slot:"StartDecorator",overridesResolver:(e,t)=>t.startDecorator})({"--Avatar-marginInlineStart":"calc(var(--Chip-decoratorChildOffset) * -1)","--Chip-deleteMargin":"0 0 0 calc(var(--Chip-decoratorChildOffset) * -1)","--Icon-margin":"0 0 0 calc(var(--Chip-paddingInline) / -4)",display:"inherit",marginInlineEnd:"var(--Chip-gap)",order:0,zIndex:1,pointerEvents:"none"}),T=(0,o.Z)("span",{name:"JoyChip",slot:"EndDecorator",overridesResolver:(e,t)=>t.endDecorator})({"--Chip-deleteMargin":"0 calc(var(--Chip-decoratorChildOffset) * -1) 0 0","--Icon-margin":"0 calc(var(--Chip-paddingInline) / -4) 0 0",display:"inherit",marginInlineStart:"var(--Chip-gap)",order:2,zIndex:1,pointerEvents:"none"}),F=n.forwardRef(function(e,t){let i=(0,Z.Z)({props:e,name:"JoyChip"}),{children:r,className:o,color:s="primary",slotProps:l={},onClick:c,disabled:d=!1,size:h="md",variant:p="solid",startDecorator:u,endDecorator:g}=i,f=(0,m.Z)(i,D),{getColor:b}=(0,y.VT)(p),P=b(e.color,s),S=!!c||!!l.action,w=(0,x.Z)({},i,{disabled:d,size:h,color:P,variant:p,clickable:S,focusVisible:!1}),F="function"==typeof l.action?l.action(w):l.action,O=n.useRef(null),{focusVisible:E,getRootProps:W}=(0,C.Z)((0,x.Z)({},F,{disabled:d,ref:O}));w.focusVisible=E;let M=z(w),L=(0,x.Z)({},f,{slotProps:l}),[U,$]=(0,k.Z)("root",{ref:t,className:(0,v.Z)(M.root,o),elementType:R,externalForwardedProps:L,ownerState:w}),[A,B]=(0,k.Z)("label",{className:M.label,elementType:I,externalForwardedProps:L,ownerState:w}),J=(0,j.Z)(B.id),[V,Y]=(0,k.Z)("action",{className:M.action,elementType:H,externalForwardedProps:L,ownerState:w,getSlotProps:W,additionalProps:{"aria-labelledby":J,as:null==F?void 0:F.component,onClick:c}}),[G,K]=(0,k.Z)("startDecorator",{className:M.startDecorator,elementType:N,externalForwardedProps:L,ownerState:w}),[X,q]=(0,k.Z)("endDecorator",{className:M.endDecorator,elementType:T,externalForwardedProps:L,ownerState:w}),Q=n.useMemo(()=>({disabled:d,variant:p,color:"context"===P?void 0:P}),[P,d,p]);return(0,a.jsx)(_.Provider,{value:Q,children:(0,a.jsxs)(U,(0,x.Z)({},$,{children:[S&&(0,a.jsx)(V,(0,x.Z)({},Y)),(0,a.jsx)(A,(0,x.Z)({},B,{id:J,children:r})),u&&(0,a.jsx)(G,(0,x.Z)({},K,{children:u})),g&&(0,a.jsx)(X,(0,x.Z)({},q,{children:g}))]}))})});var O=i(11437),E=i(90545),W=i(35086),M=i(866),L=i(28086),U=i(65326),$=i.n(U),A=i(72474),B=i(59534),J=i(78141),V=i(50157),Y=i(23910),G=i(21628),K=i(1031),X=i(78915);let{Dragger:q}=V.default,Q=(0,o.Z)(s.Z)(e=>{let{theme:t}=e;return{width:"50%",backgroundColor:"dark"===t.palette.mode?t.palette.background.level1:"#fff",...t.typography.body2,padding:t.spacing(1),textAlign:"center",borderRadius:4,color:t.vars.palette.text.secondary}}),ee=["Choose a Datasource type","Setup the Datasource"],et=[{type:"text",title:"Text",subTitle:"Fill your raw text"},{type:"webPage",title:"URL",subTitle:"Fetch the content of a URL"},{type:"file",title:"Document",subTitle:"Upload a document, document type can be PDF, CSV, Text, PowerPoint, Word, Markdown"}];var ei=()=>{let e=(0,r.useRouter)(),t=(0,r.useSearchParams)().get("name"),{mode:i}=(0,l.tv)(),[o,m]=(0,n.useState)(!1),[x,v]=(0,n.useState)(0),[f,C]=(0,n.useState)(""),[b,j]=(0,n.useState)([]),[Z,y]=(0,n.useState)(""),[P,S]=(0,n.useState)(""),[w,_]=(0,n.useState)(""),[k,D]=(0,n.useState)(""),[z,R]=(0,n.useState)(null),[I,H]=(0,n.useState)(0),[N,T]=(0,n.useState)(0),[U,V]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{(async function(){let e=await (0,X.PR)("/knowledge/".concat(t,"/document/list"),{page:1,page_size:20});e.success&&(j(e.data.data),H(e.data.total),T(e.data.page))})()},[]),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)(c.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{marginBottom:"20px"},children:[(0,a.jsxs)(d.Z,{"aria-label":"breadcrumbs",children:[(0,a.jsx)(h.Z,{onClick:()=>{e.push("/datastores")},underline:"hover",color:"neutral",fontSize:"inherit",children:"Knowledge Space"},"Knowledge Space"),(0,a.jsx)(p.ZP,{fontSize:"inherit",children:"Documents"})]}),(0,a.jsx)(u.Z,{variant:"outlined",onClick:()=>m(!0),children:"+ Add Datasource"})]}),b.length?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(g.Z,{color:"primary",variant:"plain",size:"lg",sx:{"& tbody tr: hover":{backgroundColor:"light"===i?"rgb(246, 246, 246)":"rgb(33, 33, 40)"},"& tbody tr: hover a":{textDecoration:"underline"}},children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Name"}),(0,a.jsx)("th",{children:"Type"}),(0,a.jsx)("th",{children:"Size"}),(0,a.jsx)("th",{children:"Last Synch"}),(0,a.jsx)("th",{children:"Status"}),(0,a.jsx)("th",{children:"Result"}),(0,a.jsx)("th",{children:"Operation"})]})}),(0,a.jsx)("tbody",{children:b.map(i=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:i.doc_name}),(0,a.jsx)("td",{children:(0,a.jsx)(F,{variant:"solid",color:"neutral",sx:{opacity:.5},children:i.doc_type})}),(0,a.jsxs)("td",{children:[i.chunk_size," chunks"]}),(0,a.jsx)("td",{children:$()(i.last_sync).format("YYYY-MM-DD HH:MM:SS")}),(0,a.jsx)("td",{children:(0,a.jsx)(F,{sx:{opacity:.5},variant:"solid",color:function(){switch(i.status){case"TODO":return"neutral";case"RUNNING":return"primary";case"FINISHED":return"success";case"FAILED":return"danger"}}(),children:i.status})}),(0,a.jsx)("td",{children:"TODO"===i.status||"RUNNING"===i.status?"":"FINISHED"===i.status?(0,a.jsx)(Y.Z,{content:i.result,trigger:"hover",children:(0,a.jsx)(F,{variant:"solid",color:"success",sx:{opacity:.5},children:"SUCCESS"})}):(0,a.jsx)(Y.Z,{content:i.result,trigger:"hover",children:(0,a.jsx)(F,{variant:"solid",color:"danger",sx:{opacity:.5},children:"FAILED"})})}),(0,a.jsx)("td",{children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(u.Z,{variant:"outlined",size:"sm",sx:{marginRight:"20px"},onClick:async()=>{let e=await (0,X.PR)("/knowledge/".concat(t,"/document/sync"),{doc_ids:[i.id]});e.success?G.ZP.success("success"):G.ZP.error(e.err_msg||"failed")},children:["Synch",(0,a.jsx)(J.Z,{})]}),(0,a.jsx)(u.Z,{variant:"outlined",size:"sm",onClick:()=>{e.push("/datastores/documents/chunklist?spacename=".concat(t,"&documentid=").concat(i.id))},children:"Details"})]})})]},i.id))})]}),(0,a.jsx)(c.Z,{direction:"row",justifyContent:"flex-end",sx:{marginTop:"20px"},children:(0,a.jsx)(K.Z,{defaultPageSize:20,showSizeChanger:!1,current:N,total:I,onChange:async e=>{let i=await (0,X.PR)("/knowledge/".concat(t,"/document/list"),{page:e,page_size:20});i.success&&(j(i.data.data),H(i.data.total),T(i.data.page))},hideOnSinglePage:!0})})]}):(0,a.jsx)(a.Fragment,{}),(0,a.jsx)(O.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center","z-index":1e3},open:o,onClose:()=>m(!1),children:(0,a.jsxs)(s.Z,{variant:"outlined",sx:{width:800,borderRadius:"md",p:3,boxShadow:"lg"},children:[(0,a.jsx)(E.Z,{sx:{width:"100%"},children:(0,a.jsx)(c.Z,{spacing:2,direction:"row",children:ee.map((e,t)=>(0,a.jsxs)(Q,{sx:{fontWeight:x===t?"bold":"",color:x===t?"#814DDE":""},children:[t<x?(0,a.jsx)(B.Z,{}):"".concat(t+1,"."),"".concat(e)]},e))})}),0===x?(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(E.Z,{sx:{margin:"30px auto"},children:et.map(e=>(0,a.jsxs)(s.Z,{sx:{boxSizing:"border-box",height:"80px",padding:"12px",display:"flex",flexDirection:"column",justifyContent:"space-between",border:"1px solid gray",borderRadius:"6px",marginBottom:"20px",cursor:"pointer"},onClick:()=>{C(e.type),v(1)},children:[(0,a.jsx)(s.Z,{sx:{fontSize:"20px",fontWeight:"bold"},children:e.title}),(0,a.jsx)(s.Z,{children:e.subTitle})]},e.type))})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(E.Z,{sx:{margin:"30px auto"},children:["Name:",(0,a.jsx)(W.ZP,{placeholder:"Please input the name",onChange:e=>S(e.target.value),sx:{marginBottom:"20px"}}),"webPage"===f?(0,a.jsxs)(a.Fragment,{children:["Web Page URL:",(0,a.jsx)(W.ZP,{placeholder:"Please input the Web Page URL",onChange:e=>y(e.target.value)})]}):"file"===f?(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(q,{name:"file",multiple:!1,onChange(e){var t;if(console.log(e),0===e.fileList.length){R(null),S("");return}R(e.file.originFileObj),S(null===(t=e.file.originFileObj)||void 0===t?void 0:t.name)},children:[(0,a.jsx)("p",{className:"ant-upload-drag-icon",children:(0,a.jsx)(A.Z,{})}),(0,a.jsx)("p",{style:{color:"rgb(22, 108, 255)",fontSize:"20px"},children:"Select or Drop file"}),(0,a.jsx)("p",{className:"ant-upload-hint",style:{color:"rgb(22, 108, 255)"},children:"PDF, PowerPoint, Excel, Word, Text, Markdown,"})]})}):(0,a.jsxs)(a.Fragment,{children:["Text Source(Optional):",(0,a.jsx)(W.ZP,{placeholder:"Please input the text source",onChange:e=>_(e.target.value),sx:{marginBottom:"20px"}}),"Text:",(0,a.jsx)(M.Z,{onChange:e=>D(e.target.value),minRows:4,sx:{marginBottom:"20px"}})]}),(0,a.jsx)(p.ZP,{component:"label",sx:{marginTop:"20px"},endDecorator:(0,a.jsx)(L.Z,{checked:U,onChange:e=>V(e.target.checked)}),children:"Synch:"})]}),(0,a.jsxs)(c.Z,{direction:"row",justifyContent:"flex-start",alignItems:"center",sx:{marginBottom:"20px"},children:[(0,a.jsx)(u.Z,{variant:"outlined",sx:{marginRight:"20px"},onClick:()=>v(0),children:"< Back"}),(0,a.jsx)(u.Z,{variant:"outlined",onClick:async()=>{if(""===P){G.ZP.error("Please input the name");return}if("webPage"===f){if(""===Z){G.ZP.error("Please input the Web Page URL");return}let e=await (0,X.PR)("/knowledge/".concat(t,"/document/add"),{doc_name:P,content:Z,doc_type:"URL"});if(e.success&&U&&(0,X.PR)("/knowledge/".concat(t,"/document/sync"),{doc_ids:[e.data]}),e.success){G.ZP.success("success"),m(!1);let e=await (0,X.PR)("/knowledge/".concat(t,"/document/list"),{page:N,page_size:20});e.success&&(j(e.data.data),H(e.data.total),T(e.data.page))}else G.ZP.error(e.err_msg||"failed")}else if("file"===f){if(!z){G.ZP.error("Please select a file");return}let e=new FormData;e.append("doc_name",P),e.append("doc_file",z),e.append("doc_type","DOCUMENT");let i=await (0,X.Ej)("/knowledge/".concat(t,"/document/upload"),e);if(i.success&&U&&(0,X.PR)("/knowledge/".concat(t,"/document/sync"),{doc_ids:[i.data]}),i.success){G.ZP.success("success"),m(!1);let e=await (0,X.PR)("/knowledge/".concat(t,"/document/list"),{page:N,page_size:20});e.success&&(j(e.data.data),H(e.data.total),T(e.data.page))}else G.ZP.error(i.err_msg||"failed")}else{if(""===k){G.ZP.error("Please input the text");return}let e=await (0,X.PR)("/knowledge/".concat(t,"/document/add"),{doc_name:P,source:w,content:k,doc_type:"TEXT"});if(e.success&&U&&(0,X.PR)("/knowledge/".concat(t,"/document/sync"),{doc_ids:[e.data]}),e.success){G.ZP.success("success"),m(!1);let e=await (0,X.PR)("/knowledge/".concat(t,"/document/list"),{page:N,page_size:20});e.success&&(j(e.data.data),H(e.data.total),T(e.data.page))}else G.ZP.error(e.err_msg||"failed")}},children:"Finish"})]})]})]})})]})}},78915:function(e,t,i){"use strict";i.d(t,{Tk:function(){return c},Kw:function(){return d},PR:function(){return h},Ej:function(){return p}});var a=i(21628),r=i(24214);let n=r.Z.create({baseURL:"http://127.0.0.1:5000"});n.defaults.timeout=1e4,n.interceptors.response.use(e=>e.data,e=>Promise.reject(e));var o=i(84835);let s={"content-type":"application/json"},l=e=>{if(!(0,o.isPlainObject)(e))return JSON.stringify(e);let t={...e};for(let e in t){let i=t[e];"string"==typeof i&&(t[e]=i.trim())}return JSON.stringify(t)},c=(e,t)=>{if(t){let i=Object.keys(t).filter(e=>void 0!==t[e]&&""!==t[e]).map(e=>"".concat(e,"=").concat(t[e])).join("&");i&&(e+="?".concat(i))}return n.get("/api"+e,{headers:s}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})},d=(e,t)=>{let i=l(t);return n.post("/api"+e,{body:i,headers:s}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})},h=(e,t)=>{let i=l(t);return n.post(e,{body:i,headers:s}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})},p=(e,t)=>n.post(e,{body:t}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})}},function(e){e.O(0,[180,550,752,685,86,693,118,440,672,55,642,253,769,744],function(){return e(e.s=78273)}),_N_E=e.O()}]);